{% extends "base.html" %}
{% block title %}My Cart{% endblock %}

{% block content %}
<h2 class="mb-3">ðŸ›’ My Cart</h2>

{% if cart_items %}
<form method="post" action="{% url 'update_cart' %}">
    {% csrf_token %}
    <table class="table table-striped align-middle">
        <thead>
            <tr>
                <th>Product</th>
                <th>Price</th>
                <th style="width: 150px;">Quantity</th>
                <th>Subtotal</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
        {% for item in cart_items %}
            <tr>
                <td>
                    <div class="d-flex align-items-center">
                        <img src="{{ item.advert.image.url }}" alt="{{ item.advert.title }}"
                             class="me-2 rounded" style="width: 50px; height: 50px; object-fit: cover;">
                        <span>{{ item.advert.title }}</span>
                    </div>
                </td>
                <td>KSh {{ item.advert.price }}</td>
                <td>
                    <div class="input-group input-group-sm">
                        <button type="submit" name="decrease" value="{{ item.id }}" class="btn btn-outline-secondary">-</button>
                        <input type="text" name="quantity_{{ item.id }}" value="{{ item.quantity }}"
                               class="form-control text-center" readonly>
                        <button type="submit" name="increase" value="{{ item.id }}" class="btn btn-outline-secondary">+</button>
                    </div>
                </td>
                <td>KSh {{ item.subtotal }}</td>
                <td>
                    <a href="{% url 'remove_from_cart' item.id %}"
                       class="btn btn-danger btn-sm">
                        ðŸ—‘ Remove
                    </a>
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

    <h4 class="mt-3">Total: <strong>KSh {{ total }}</strong></h4>

    <button type="submit" class="btn btn-primary mt-2">Update Cart</button>
    <a href="#" class="btn btn-success mt-2">Proceed to Checkout (M-Pesa)</a>
</form>
{% else %}
<p>Your cart is empty.</p>
{% endif %}
{% endblock %}
